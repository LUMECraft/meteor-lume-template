<!-- prettier-ignore -->
<head>
	<title>Meteor Lume Template</title>

	<!-- The favion needs to align with the browser UI, which aligns with the
	system theme, so this does not rely on the app's theme switch. TODO: use
	watchMedia for the OS setting so we can change the value even in unfocused
	tabs (the browser may otherwise avoid updating the favicon until a tab is
	focused). -->
	<link rel="icon" href="/images/logo.svg" media="(prefers-color-scheme: light)" />
	<link rel="icon" href="/images/logo-dark.svg" media="(prefers-color-scheme: dark)" />

	<meta charset="utf-8" />
	<meta name="robots" content="all" />

	<meta name="application-title" content="Meteor Lume Template" />
	<meta name="description" content="...TODO..." />
	<meta name="keywords" content="...TODO..." />

	<meta property="og:title" content="Meteor Lume Template" />
	<meta property="og:description" content="...TODO..." />
	<meta property="og:url" content="https://example.com" />
	<meta property="og:image" content="...TODO image for sharing..." />
	<meta property="og:image:alt" content="...TODO Description of the share image..." />
	<meta property="og:site_name" content="Meteor Lume Template" />
	<meta property="og:type" content="website" />

	<meta name="twitter:title" content="Meteor Lume Template" />
	<meta name="twitter:description" content="...TODO..." />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:site" content="@your_twitter_handle" />
	<meta name="twitter:creator" content="@your_twitter_handle" />
	<meta name="twitter:image" content="...TODO image for sharing..." />

	<meta name="generator" content="meteor+lume" />
	<meta name="color-scheme" content="light dark" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<meta name="theme-color" content="#0043fa" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="default" />
	<meta name="msapplication-TileColor" content="#0043fa" />

	<!--
	Style variables are loaded in JS so that they can be used in both JS and CSS.
	TODO: Instead of mapping from JS to CSS, map from CSS to JS. First we need a way to map CSS var types to TS types for type safety. Right now we don't have CSS intellisense because of the variables coming from JS, but I consider that less of a problem than the other way around.
	-->
	<script src="/styleVars.js"></script>

	<link rel="stylesheet" href="/entry.css" />
</head>

<body>
	<script>
		//////////// Cross-Origin Authentication /////////////////////////////////
		// Listen for credentials requests. This is used by other origins that
		// load the main origin in an iframe for authentication.
		//
		// A main origin (the one running the Meteor server) runs this code. A
		// trusted non-main origin (the one loading the main origin with this
		// code in an iframe) can then request the login credentials from the
		// main origin by sending a message with the type 'getLoginCredentials'.
		// The main origin will then respond with the login credentials for user
		// and Meteor code running on the non-main origin can work with the main
		// origin's Meteor server. If the user is not logged in on the main
		// origin, the non-main origin can log in the user, and share the login
		// credentials with the main origin by sending a message with the type
		// 'setLoginCredentials', so that when the user visits the main origin
		// later, they will be logged in there as well.
		//
		// For an example of a non-main origin that loads Meteor from a main
		// origin and authenticates with the main origin's Meteor server, see
		// how https://docs.lume.io (a non-main origin) calls to https://lume.io
		// (the main origin running this code) to get the login credentials
		// here:
		//
		// - https://github.com/lume/lume.github.io/blob/main/index.html#L63
		// - https://github.com/lume/lume.github.io/blob/main/load-meteor.js#L115
		// - https://github.com/lume/lume.github.io/blob/main/load-meteor-auth.js
		//
		// Note that CORS headers are set in the server code to allow the site
		// to be embedded only on our authorized domains, so the '*' value for
		// `targetOrigin` is safe.
		//
		// TODO: Put this in a re-usable package we can share with the Meteor community.
		window.addEventListener('message', event => {
			// This message is used by an authorized origin to get login
			// credentials.
			if (event.data.type === 'getLoginCredentials') {
				event.source?.postMessage(
					{
						type: 'loginCredentials',
						token: localStorage.getItem('Meteor.loginToken'),
						expires: localStorage.getItem('Meteor.loginTokenExpires'),
						userId: localStorage.getItem('Meteor.userId'),
					},
					{targetOrigin: '*'},
				)
			}

			// If someone is not logged into the primary origin where the
			// backend is served from (f.e. lume.io) then the non-primary domain
			// (f.e. docs.lume.io) can log in and set the credentials with this
			// message so that when the user visits the primary domain (or any
			// other domain that uses getLoginCredentials), they will be logged
			// in. Basically log in across all authorized domains.
			if (event.data.type === 'setLoginCredentials') {
				console.log('main origin received login credentials:', event.data.token)
				localStorage.setItem('Meteor.loginToken', event.data.token)
				event.source?.postMessage({type: 'confirmSetLoginCredentials'}, {targetOrigin: '*'})
			}
		})
	</script>

	<!-- TODO -->
	<!-- Google Analytics -->
	<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-5B93FS5P5X"></script>
	<script>
		window.dataLayer = window.dataLayer || []
		function gtag() {
			dataLayer.push(arguments)
		}
		gtag('js', new Date())
		gtag('config', 'G-5B93FS5P5X')
	</script> -->

	<script src="/importmap.js"></script>
	<script type="module" src="/entry.js"></script>

	<div id="root">
		<!-- app content gets rendered here -->
	</div>

	<!-- Load the loading icon module as soon as possible so that we have a
	loading experience as soon as possible before loading anything else
	(see the modulepreload in importmap.js) -->
	<script type="module" async>
		import 'lume/dist/examples/LoadingIcon.js'
	</script>

	<div id="loadingCover">
		<loading-icon></loading-icon>
	</div>
</body>
